"use strict";(()=>{function N(e=window){let n=[],t=e;for(;t;){n.unshift({window:t,frame:null});try{let o=t.parent,r=Array.from(o.document.getElementsByTagName("iframe"));for(let i of r)if(i.contentWindow===t){n[0].frame=i;break}if(o===t)break;t=o}catch{break}}return n}function T(){let e=N()[0].window,n=e.document,t=0;return typeof e.pageYOffset=="number"?t=e.pageYOffset:n.documentElement?.scrollTop?t=n.documentElement.scrollTop:n.body?.scrollTop&&(t=n.body.scrollTop),t}function I(){let e=N()[0].window,n=e.document,t=n.body,o=n.documentElement||n.body;return{viewport:e.innerHeight||o.clientHeight,window:Math.max(t.scrollHeight,t.offsetHeight,o.clientHeight,o.scrollHeight,o.offsetHeight)}}function h(e){try{window.console.log(`Dable DEBUG: ${e}`)}catch{}}var v=class{constructor(n){this.executor=n}execute(n){let t=Array.prototype.shift.apply(n);this.executor[t]?this.executor[t].apply(this.executor,n):h(`\uC874\uC7AC\uD558\uC9C0 \uC54A\uB294 \uBA85\uB839\uC785\uB2C8\uB2E4: ${t}`)}push(n){if(Array.isArray(n[0])){for(let t=0;t<n.length;t++){let o=n[t];this.push(o)}return}return this.execute(n)}};function D(){return location?.protocol==="http:"?"http:":"https:"}function H(e){return`${e||D()}//${window.TEST_API_SERVER_DOMAIN||"api.dable.io"}`}function W(e){return`${e||D()}//${window.TEST_AD_LOGGING_SERVER_DOMAIN||"ad-log.dable.io"}`}function l(e){let t=new RegExp(`\\b${e}=(.*?)(?:[,;]|$)`).exec(document.cookie);return t&&t[1]&&t[1]!=="null"?t[1]:""}function g(e,n,t=60){let o=new Date(Date.now()+t*1e3),r=location.hostname.split("."),i=Math.max(0,r.length-2)+1;for(;--i>=0;){let c=r.slice(i).join("."),s=`${e}=${n}; path=/; domain=${c}; expires=${o.toUTCString()};`;if(document.cookie=s,l(e))return}}function B(e){if(!e||typeof e!="object")return!1;let n=Object.getPrototypeOf(e);return n===null||n===Object.prototype}var ee=function(){let e=0;return()=>++e}();function te(e){let n=document.createElement("script"),t=!1;n.src=e,n.async=!0,n.onload=()=>{t||(t=!0,n.onload=null,n?.parentNode?.removeChild(n))},document.head.appendChild(n)}function C(e,n=""){let t={};return Array.isArray(e)?e.forEach((o,r)=>Object.assign(t,C(o,`${n}[${r}]`))):B(e)?Object.entries(e).forEach(([o,r])=>Object.assign(t,C(r,`${n}${n?`[${o}]`:o}`))):n&&(t[n]=e===void 0?"":String(e)),t}function P(e,n={},t){let o=new URLSearchParams(C(n)),r=`_dbljson${ee()}`;return typeof window=="object"&&(window[r]=i=>{t?.(i)}),o.set("callback",r),o.set("_",String(Date.now())),te(`${e}?${o.toString()}`),r}function M(e,n){return e=e%1?Math.round(e):e,Math.min(e,Math.floor(n))}function ne(e={}){let{min:n,max:t}=e;e.digits&&(n=Math.pow(10,e.digits-1),t=Math.pow(10,e.digits)-1),(n===void 0||t===void 0)&&(n=0,t=1);let o=n+Math.random()*(t-n);return e.digits?M(o,t):o}function Q(e){let n=ne(e);return M(n,e?.max||Math.ceil(n))}function ie(e={}){let{min:n,max:t}=e;return e.digits&&(n=Math.pow(10,e.digits-1),t=Math.pow(10,e.digits)-1),(n===void 0||t===void 0)&&(n=0,t=1),{min:n,max:t}}function oe({min:e,max:n,scalingFactor:t}){return e+t*(n-e)}function re(){let e=window.crypto||window.msCrypto;if(!(e&&e.getRandomValues))return Math.random();let n=4294967295,t=new Uint32Array(1);return e.getRandomValues(t),t[0]/n}function k(e={}){let n=re(),{min:t,max:o}=ie(e),r=oe({min:t,max:o,scalingFactor:n});return e.digits?M(r,o):r}function ce(){if(window.fbq)return;let e=window.fbq=(...t)=>{e.callMethod?e.callMethod.apply(e,t):e.queue?.push(t)};window._fbq||(window._fbq=e),e.push=e,e.loaded=1,e.version="2.0",e.queue=[];let n=document.createElement("script");n.async=!0,n.src="https://connect.facebook.net/en_US/fbevents.js",document.getElementsByTagName("script")[0]?.insertAdjacentElement("beforebegin",n)}function z(e,n){ce(),window.fbq?.("init",`${e}`),window.fbq?.("track",n)}function ae(e){let{platform:n,platformVersion:t,wow64:o,mobile:r,model:i}=e,c=t.replace(/\./g,"_");if(n==="Android"&&r)return`Linux; Android ${c}; ${i}`;if(n==="macOS")return`Macintosh; Intel Mac OS X ${c}`;if(n==="Windows"){let s=t.split("."),u=parseInt(s[0]),f=o?"WOW64":"Win64; x64";return u>0?`Windows NT 10.0; ${f}`:`Windows NT 6.${s[1]}; ${f}`}return n==="Chrome OS"?`X11; CrOS x86_64 ${t}`:n==="Linux"?"X11; Linux x86_64":`${n} ${t}`}function X(){let e=navigator.userAgentData,n=Promise.resolve("");if(!e||!e.getHighEntropyValues)return n;let t=Number(e.brands.find(o=>o.brand==="Chromium")?.version);return!t||t<101?n:e.getHighEntropyValues(["mobile","platformVersion","platform","fullVersionList","model","wow64"]).then(o=>{let r=o.fullVersionList.find(s=>s.brand==="Chromium")?.version,i=ae(o),c=navigator.userAgent.replace(/\bChrome\/[\d.]+/,`Chrome/${r}`).replace(/^(Mozilla\/5\.0) \(.+?\)/,`$1 (${i})`);return navigator.userAgent!==c?c:""})}var J=/[\?\&]dablena=([^\|]+)\|([^\|]+)\|([^\|]+)\|([^\|]+)\|([^\|\#\&]+)\|([^\|\#\&]+)(?:\|([^\|\#\&]+))(?:\|([^\|\#\&]+))(?:\|(\d+))?(?:\|(\d+))?(?:\|([^\|\#\&]+))?(?:\|(\d+))?(?:\|(\d+))?/,de=String(Math.round(k()*1e8)),le=1e3*10,V=1e3*60*30,ue=1e3*60*60*24*30,x=!1,y=null,w=null,Y=!0,L=null,A=e=>{let n=null;try{n=decodeURIComponent(e)}catch{n=unescape(e)}return n};function b(e,n){let t,{client_name_or_account_id:o,event_type:r,data:i={},uid:c,cid:s,cached_click:u,cached_conversion:f,client_id:$,items:R}=e;i===null&&(i={});let E=A(window?.location?.href||"");if(E.indexOf("dablena=NATEST")>-1)return;let a=window?.location?.href?.match(/[\?\&]utm_[a-z]+=[^\#\&]+/g);u||f?(t=(u||f).split("|"),t.unshift("")):t=E.match(J);let p=document?.referrer||"";p.indexOf("api.dable.io/widgets")>-1?(c=A(p.split("/")[7]?.split("?")[0]||"")||c,i.widget_id=p.split("/")[5],i.service_name=t?.[3]||A(p.match(/[\?\&]site=([^\#\&]+)/)?.[1]||""),i.campaign_id=t?.[4]||"",i.content_id=t?.[5]||"",i.method=t?.[6]||"",i.channel=t?.[7]||"",i.request_id=t?.[8]||"",i.click_timestamp=t?.[9]||"",i.request_timestamp=t?.[10]||"",i.inventory_id=t?.[11]||"",i.page=t?.[12]||"",i.slot=t?.[13]||""):t&&(c=t?.[1]||c,i.widget_id=t?.[2],i.service_name=t?.[3],i.campaign_id=t?.[4]||"",i.content_id=t?.[5]||"",i.method=t?.[6]||"",i.channel=t?.[7]||"",i.request_id=t?.[8]||"",i.click_timestamp=t?.[9]||"",i.request_timestamp=t?.[10]||"",i.inventory_id=t?.[11]||"",i.page=t?.[12]||"",i.slot=t?.[13]||""),i.url=window?.location?.href||"",i.ref=p,i.cid=s,$&&(i.client_id=$),R&&(i.items=R),(r.indexOf("adview+")===0||r.indexOf("inlinkview+")===0||x&&i.session_id)&&(i.duration=e.duration||0,i.scroll_y=e.scroll_y,i.page_height=e.page_height,i.window_height=e.window_height);let _=`${W("https:")}/logs`;if(_+=`/clients/${encodeURIComponent(o)}`,_+=`/users/${encodeURIComponent(c)}/${r}`,a)for(let d=0;d<a.length;d++){let m=a[d]?.substring(1).split("=");i[m[0]]=A(m[1])}i.z=String(Math.round(Math.random()*1e6));let O=setTimeout(function(){n?.()},2e3);X().then(d=>{d&&(i.user_agent=d),P(_,i,function(m){m!=="OK"&&h(m),clearTimeout(O),n?.()})})}var fe=e=>{let n=0;L=new Date().getTime();let t=setInterval(function(){let o=new Date().getTime();o-L>le&&clearInterval(t),L=o,n=n+1,e.duration=n;try{let r=I();e.scroll_y=T(),e.page_height=r.window,e.window_height=r.viewport}catch{e.scroll_y=-1,e.page_height=-1,e.window_height=-1}b(e),g(y,w,V)},1e3)},K=(e,n,t)=>{setTimeout(function(){e.event_type=`adview+${n}`,e.duration=n;try{let o=I();e.scroll_y=T(),e.page_height=o.window,e.window_height=o.viewport}catch{e.scroll_y=-1,e.page_height=-1,e.window_height=-1}t?t(e):b(e)},n*1e3)},me=(e,n)=>{let{count:t}=n;n.duration=t,b(n),(t===5||t===30)&&(e.event_type=`inlinkview+${t}`,e.duration=t,b(e))};function Z(e,n){let{client_name_or_account_id:t,uid:o,cid:r,cached_click:i,cached_conversion:c,client_id:s,items:u,data:f}=e,$=window?.location?.href?.match(/[\?\&]utm_[a-z]+=[^\#\&]+/g),E=A(window?.location?.href||"").match(J),a="visit";y=`__dbl__se_${s}`;let p=`__dbl__re_${s}`;x=!1;let _=!!l(y),O=!!l(p);(E||i)&&(f?.is_native?a="inlinkview":a="adview",_?w=l(y):(w=r.slice(0,3)+String(Math.round(k()*1e8)),g(p,1,ue)),x=!0,g(y,w,V)),a==="visit"&&(_||O)&&(_?w=l(y):O&&(w=r.slice(0,3)+String(Math.round(k()*1e8))),x=!0,g(y,w,V));let d={event_type:a,client_name_or_account_id:t,uid:o,cid:r,cached_click:i,cached_conversion:c,client_id:s,items:u},m={event_type:a,client_name_or_account_id:t,uid:o,cid:r,cached_click:i,cached_conversion:c,client_id:s,items:u,data:{session_id:w,user_page_id:de}};if(a==="inlinkview"){let{scroll_y:U,page_height:q,window_height:j,count:F}=f;Object.assign(d,{scroll_y:U},{page_height:q},{window_height:j},{count:F}),Object.assign(m,{scroll_y:U},{page_height:q},{window_height:j},{count:F}),me(d,m)}Y&&(a==="adview"&&(K(d,5),K(d,30)),x&&a!=="inlinkview"&&fe(m),a==="visit"&&(!x||$)?b(d,n):n&&n(),f?.is_native&&(Y=!1))}var he=e=>/\d\d\d-\d\d\d-\d\d\d/.test(e)?Number(e.split("-").join("").substring(3)):null,pe={Visit:{type:"visit"},PageView:{type:"visit"},ViewContent:{type:"content"},Search:{type:"search"},AddToCart:{type:"cart"},AddToWishlist:{type:"wishlist"},InitialCheckout:{type:"checkout"},InitiateCheckout:{type:"checkout"},AddPaymentInfo:{type:"payment"},Purchase:{type:"purchase",validateData(e){if(!e?.value||!e?.currency)throw new Error("Missing value or currency data")}},Lead:{type:"lead"},CompleteRegistration:{type:"registration"},event1:{type:"event1"},event2:{type:"event2"},event3:{type:"event3"}},S=class{cacheCookieName=void 0;cacheExpire=void 0;constructor(){this.cacheCookieName="dable_uid",this.cacheExpire=3*365*24*60*60*1e3}init(n){this.clientNameOrAccountId=n}track(n,t,o){if(typeof t=="function"&&(o=t,t=null),o||(o=function(){}),!this.clientNameOrAccountId){h("init should executed before executing track method"),o();return}if(location.href.indexOf("gtm-msr.appspot")>-1){o();return}let r=pe[n];try{if(r)r.validateData&&r.validateData(t);else throw new Error(`Invalid event code: ${n}`)}catch(i){h(String(i));return}this.fetchPrefs(i=>{this.fetchUID(c=>{if(i.sp_client===null){h(`Invalid ID: ${this.clientNameOrAccountId}`),o();return}i.sp_client?.facebook?.enabled&&i.sp_client?.facebook?.pixel_id&&z(i.sp_client.facebook.pixel_id,n),(n==="PageView"?Z:b)({client_name_or_account_id:this.clientNameOrAccountId,event_type:r.type,data:t,uid:c,cid:i.cid,cached_click:i.sp_client?.cached_click,cached_conversion:i.sp_client?.cached_conversion,client_id:i.sp_client?.client_id},o)})})}fetchPrefs(n){if(!this.clientNameOrAccountId){h("init should executed before executing fetchPrefs method");return}if(this.prefs){let c=this.clientNameOrAccountId===this.prefs.sp_client?.client_name,s=he(this.clientNameOrAccountId)===this.prefs.sp_client?.client_id;if(c||s){n(this.prefs);return}}if(this.fetchPrefsQueue){this.fetchPrefsQueue.push(n);return}this.fetchPrefsQueue=[n];let t=l(this.cacheCookieName),o=window?.location?.href?.match(/[\?\&]ecid=([^\#\&]+)/)?.[1],r=window?.location?.href?.match(/[?&]request_id=([^#&]+)/)?.[1],i={paramUid:"",cached_uid:"",requestId:""};o&&(i.paramUid=o),r&&(i.requestId=r),t&&t!=="undefined"&&(i.cached_uid=t),P(`${H("https:")}/plugin/services/${encodeURIComponent(this.clientNameOrAccountId)}/prefs2`,i,c=>{this.prefs=c&&c.result||null;for(let s=0;s<this.fetchPrefsQueue.length;s++){let u=this.fetchPrefsQueue[s];u(this.prefs)}this.fetchPrefsQueue=null,g(this.cacheCookieName,this.prefs.cid,this.cacheExpire)})}fetchUID(n){this.fetchPrefs(t=>{n(t.cid||`${Q({min:1e7,max:99999999})}.${Date.now()}`)})}};(e=>{let n=e.q||[];if(Array.isArray(n)){e.q=new v(new S);for(let t=0;t<n.length;t++){let o=n[t];e.q.push(o)}}})(window.dablena);})();
